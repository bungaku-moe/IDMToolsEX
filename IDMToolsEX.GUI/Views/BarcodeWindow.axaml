<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:IDMToolsEX.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="350" d:DesignHeight="250"
        x:Class="IDMToolsEX.Views.BarcodeWindow"
        x:DataType="vm:BarcodeWindowViewModel"
        MinWidth="800" MinHeight="500"
        Icon="/Assets/app-icon.ico"
        Title="IDMToolsEX - Cek Barcode"
        TransparencyLevelHint="AcrylicBlur"
        Background="WhiteSmoke">

    <Grid RowDefinitions="Auto,*">
        <!-- Top Controls Section -->
        <Grid Grid.Row="0" ColumnDefinitions="1*,2*" RowDefinitions="Auto" Margin="10">
            <!-- Left: Custom PLU Input -->
            <HeaderedContentControl Grid.Column="0" Header="PLU Kustom" Margin="0,0,10,0">
                <StackPanel Spacing="8">
                    <ScrollViewer MaxHeight="135" MinHeight="135"
                                  HorizontalAlignment="Stretch"
                                  VerticalScrollBarVisibility="Auto"
                                  HorizontalScrollBarVisibility="Auto">
                        <TextBox Name="PluListTextBox"
                                 Text="{Binding PluList}"
                                 AcceptsReturn="True"
                                 TextWrapping="Wrap"
                                 HorizontalAlignment="Stretch"
                                 VerticalAlignment="Stretch" />
                    </ScrollViewer>
                    <Button Content="Buat Barcode"
                            Command="{Binding GenerateBarcodeCommand}"
                            HorizontalAlignment="Stretch" HorizontalContentAlignment="Center"
                            FontWeight="Bold" />
                </StackPanel>
            </HeaderedContentControl>

            <!-- Right: Modis Display -->
            <HeaderedContentControl Grid.Column="1" Header="Display Barang">
                <StackPanel Spacing="10">
                    <!-- Modis Combo + Desc -->
                    <StackPanel Orientation="Horizontal" Spacing="15">
                        <StackPanel Orientation="Horizontal" Spacing="5">
                            <TextBlock Text="Modis:" VerticalAlignment="Center" />
                            <ComboBox ItemsSource="{Binding ModisShelfNames}"
                                      SelectedItem="{Binding SelectedModis}"
                                      SelectionChanged="OnModisSelectionChanged"
                                      MinWidth="250" />
                        </StackPanel>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="{Binding SelectedModisDescription}"
                                       FontSize="12" Foreground="Gray"
                                       TextWrapping="Wrap" MaxWidth="250" VerticalAlignment="Center"
                                       HorizontalAlignment="Stretch" />
                        </StackPanel>
                    </StackPanel>

                    <!-- Shelf Range -->
                    <StackPanel Orientation="Horizontal" Spacing="10">
                        <TextBlock Text="Shelf:" VerticalAlignment="Center" />
                        <ComboBox ItemsSource="{Binding ShelfOptions}"
                                  SelectedItem="{Binding SelectedShelfFrom}"
                                  Width="80" />
                        <TextBlock Text="Sampai:" VerticalAlignment="Center" />
                        <ComboBox ItemsSource="{Binding ShelfOptions}"
                                  SelectedItem="{Binding SelectedShelfTo}"
                                  Width="80" />
                    </StackPanel>

                    <!-- Generate Barcode Button -->
                    <Button Content="Buat Barcode Dari Modis"
                            Command="{Binding GenerateBarcodeFromModisCommand}"
                            Padding="15,10"
                            FontWeight="Bold"
                            HorizontalAlignment="Left"
                            MinWidth="180" />

                    <!-- Options -->
                    <CheckBox Content="1 Barcode per Item"
                              IsChecked="{Binding IsOneBarcode}"
                              VerticalAlignment="Center" />
                </StackPanel>
            </HeaderedContentControl>
        </Grid>

        <!-- Bottom Barcode Table -->
        <DataGrid Grid.Row="1"
                  ItemsSource="{Binding BarcodeList}"
                  AutoGenerateColumns="False"
                  CanUserReorderColumns="True" CanUserResizeColumns="True" CanUserSortColumns="True" Margin="10">
            <DataGrid.Columns>
                <DataGridTextColumn Header="NO." Binding="{Binding Index}" Width="65" />
                <DataGridTextColumn Header="PLU" Binding="{Binding Plu}" Width="85" />
                <DataGridTextColumn Header="SINGKATAN" Binding="{Binding Abbreviation}" Width="1.1*" />
                <DataGridTextColumn Header="DESKRIPSI" Binding="{Binding Description}" Width="1.8*" />
                <DataGridTextColumn Header="BARCODE" Binding="{Binding BarcodeText}" Width="*" />
                <DataGridTemplateColumn Width="*">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Image Source="{Binding BarcodeImage}" MinWidth="280" MinHeight="220" Margin="12" />
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridCheckBoxColumn Header="INVALID?" Binding="{Binding IsInvalid}" Width="40" PropertyChanged="OnInvalidBarcodeChanged" />
            </DataGrid.Columns>
        </DataGrid>
    </Grid>
</Window>
